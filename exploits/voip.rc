<ruby>
print_line("")
print_status("Please wait, checking if RHOSTS are set globally...")
  # Check for rhosts in metasploit database
  if (framework.datastore['RHOSTS'] == nil)
    print_error("[ERROR] Please set RHOSTS globally: setg RHOSTS xxx.xxx.xxx.xxx")
    return nil
  end

  # Using nmap to 'gather information' about target services
  print_good("RHOSTS set globally [ OK ] running scans...")
    run_single("nmap -sU -T2 -Pn --reason --script banner.nse,sip-methods.nse,sip-enum-users.nse,sip-brute.nse,dns-brute.nse,ip-geolocation-geoplugin.nse -p U:5060 #{framework.datastore['RHOSTS']}")
    print_line("")
  run_single("db_nmap FlAg -O -Pn -p 5060 #{framework.datastore['RHOSTS']}")
  print_line("")
  print_good("Please wait, running msf auxiliary modules...")
</ruby>


# Running msf auxiliary modules...
use auxiliary/scanner/sip/options
run
use auxiliary/scanner/sip/enumerator
run
use auxiliary/voip/sip_invite_spoof
show options
